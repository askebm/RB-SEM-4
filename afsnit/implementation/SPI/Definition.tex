\documentclass[../../../main]{subfiles}
\begin{document}
\subsubsection{Definition}
\label{sub:definition}
Full duplex, 2MHz, Read on rising edge.
\\
When communication initiates, Slave Enable is driven low and 1 SPI clock cycle later 
data will be read on rising edge from the SPI clock, as seen in figure \ref{fig:spi_timing_diagram}.
\\
Each datagram is 12 bits in size and the package format send by the Tiva 
\todo{Hvordan refererer vi til Tivaen}
can be seen in table \ref{tab:package_format_tiva} and the package format send by the FPGA
can be seen in table \ref{tab:package_format_fpga}.
In the package format the bit number indicates the order of transmission starting with 0.
byt nuberr

\begin{table}[h]
	\centering
	\begin{tabular}{ll}
		\textbf{Tiva}& \textbf{Datatype}  \\
		Velocity/PWM& 9 bit signed \\
		\textbf{FPGA}& \\
		Position& 12 bit signed \\
		Velocity& 12 bit signed \\
		Amps& 12 bit unsigned \\
		Index& 12 bit unsigned 
	\end{tabular}
	\caption{Data types}
	\label{tab:spi_datatypes}
\end{table}

\begin{table}[h]
	\centering
	\caption{Package format - Tiva}
	\label{tab:package_format_tiva}
	\begin{tabular}{|*{12}{p{.25cm}|}}
		\hline
		0&1&2&3&4&5&6&7&8&9&10&11\\ 
		\hline
		\multicolumn{9}{|c|}{Velocity M0  - 9bits} & R P 0 & R V 0 & R A 0 \\
		\hline
		\multicolumn{9}{|c|}{Velocity M1  - 9bits} & R P 1 & R V 1 & R A 1 \\
		\hline
		R I & R M 0 & R M 1 & \multicolumn{9}{c|}{Reserved for future use}\\
		\hline
	\end{tabular}
\end{table}
\begin{table}[h]
	\centering
	\caption{Shorthand}
	\label{tab:shorthand}
	\begin{tabular}{ll}
	RPX & Request position from motor X\\
	RVX & Request velocity from motor X\\
	RAX & Request amps from motor X\\
	RMX & Reset position of motor X\\
	RI & Request index values from homing sensors
	\end{tabular}
\end{table}

\begin{table}[h]
	\centering
	\caption{Package format - FPGA}
	\label{tab:package_format_fpga}
	\begin{tabular}{|c|*{12}{p{.25cm}|}}
		\hline
		If flag is 1 in request msg&0&1&2&3&4&5&6&7&8&9&10&11\\
		\hline
		RP0& \multicolumn{12}{c|}{Position}\\
		\hline
		RV0& \multicolumn{12}{c|}{Velocity}\\
		\hline
		RA0& \multicolumn{12}{c|}{Amps}\\
		\hline
		RP1& \multicolumn{12}{c|}{Position}\\
		\hline
		RV1& \multicolumn{12}{c|}{Velocity}\\
		\hline
		RA1& \multicolumn{12}{c|}{Amps}\\
		\hline
		RI& \multicolumn{10}{c|}{Reserved for future use}&I1&I0\\
		\hline
	%\multicolumn{12}{|c|}{Request0 - 0 to 36 bits}\\
	%\multicolumn{12}{|c|}{Request1 - 0 to 36 bits}\\
	%\multicolumn{12}{|c|}{Request Hall index sensors - 0 to 12 bits}\\
	%\hline
	\end{tabular}
\end{table}

\begin{figure}[h]
	\center
\begin{tikztimingtable}[timing/font=\normalfont]
	{2 MHz Clock}&4L2t14{2t}2t2L\\
	{Slave Enable}&2H18L2H\\
	{MOSI}&3L8{2D{}}3L\\
	{MISO}&3U8{2D{}}3U\\
\end{tikztimingtable}
\caption{SPI timing diagram}
\label{fig:spi_timing_diagram}
\end{figure}

\end{document}
