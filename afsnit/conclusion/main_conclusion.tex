\documentclass[../../main]{subfiles}
\begin{document}

In this section its concluded to which extend the problems in the problemstatement is solved.

\paragraph{Control engineering}
A mathematical model of the pan-tilt system has been made.
A nonlinaerity is here observed for the top and bottom frame. The top frames nonlinaerity is approximated by linearization with the Jacobian matrix in angles $0^\circ$, $90^\circ$ and $180^\circ$.
Its here determined that the bottom frame is dependent on the top frame, but the top frames effect is negligible.

Based on the modelled system a PI-controller with $K_p$ and $T_i$ gains have been tuned and then tuned by hand to comply with the performance specifications to the best extend possible.
This controller is implemented on the using tustin's method Tiva.
Step responses of the actual system have been logged and compared with the expected step responses from the mathematical model.

The step responses based on the mathematical model have no overshoot compared with the actual system.

Based on the results it is concluded that the mathematical model is not accurate enough to apply directly.\\

\paragraph{Digital System Design}
On the FPGA decoders are implemented to decode the position from the quadrature encoders on the pan-tilt system.
. This is done with a implemented PWM module.\\
The FPGA can determine the position with a $\frac{1}{3}$ degrees precision and direction, in which the system is rotating. A velocity has been implemented, which can be calculated from the position.\\
The PWM signal's frequency has been calculated to be $1003 \si{\,Hz}$, as this allows the motor to draw full current and utilize all available torque. \\
The SPI protocol is a shift register protocol with a register size varying from 8 bits to a maximum of 16 bits. The protocol follows the master/slave princple, with the Tiva as the master and FPGA as slave. This protocol has been implemented on the FPGA by using a SPI module.

\paragraph{Embedded Programming}
A real time operating system, FreeRTOS, has been implemented on the Tiva. FreeRTOS has been chosen as it can emulate tasks running in parallel. \\
The controller is implemented on the Tiva as a task with the highest priority to make sure it has the most consistent timing possible for the controller.

\begin{itemize}
  \item PI controller choice
  \item control engineering:
  \begin{itemize}
    \item issue with nonlinaer modeling - how did we solve this?
    \item top and bottom frrame - two "individual" systems - are. theoretically fulfilling our requirements
    \item reality vs theoretical top and bottom frame - plus the finished handtuned values for Ki and Kp
  \end{itemize}
  \item design choices FPGA:
    \begin{itemize}
      \item Encoder - position counting with 1080 ticks or 1/3 degrees precision
      \item SPI - Protocol used
      \item PWM
      \item Homing?
    \end{itemize}
  \item embedded:
  \begin{itemize}
    \item Pi micrcontroller
    \item FreeRTOS
  \end{itemize}


\end{itemize}


\end{document}
