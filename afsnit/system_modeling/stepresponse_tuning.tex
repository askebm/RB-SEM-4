\documentclass[../../main]{subfiles}
\begin{document}

To tune the theoretical model the electromotive force, the motor torque and friction, is adjusted for both the top frame and the bottom frame, to fit the openloop stepresponse of the physical system.
The system is tuned using the simulink models seen in figure \ref{fig:simulink_top} and in figure 
\ref{fig:simulink_bot}.


\begin{figure}[h]
        \centering
  			\fontsize{10}{12}\selectfont
				\def\svgwidth{1.3\textwidth}
  			\makebox[\textwidth][c]{
        	\includesvg[\main/afsnit/system_modeling/img/]{simulink_top}
				}
				\caption{Simulink Top frame. J is inertia, L is henry, R is resistance,
				g is force of gravity, b is friction,l is the length of the frame,
				$m_{corner}$ is the mass of a corner bracket, motor\_torque is the motor torque constant
				and electro force is the electro force constant.}
        \label{fig:simulink_top}
\end{figure}

\begin{figure}[h]
        \centering
				\def\svgwidth{1.3\textwidth}
  			\fontsize{10}{12}\selectfont
  			\makebox[\textwidth][c]{
        	\includesvg[\main/afsnit/system_modeling/img/]{simulink_bot}
				}
				\caption{Simulink Bottom frame. J is inertia, L is henry, R is resistance,
				g is force of gravity, b is friction,l is the length of the frame,
				$m_{corner}$ is the mass of a corner bracket, $mass_{top}$ is the mass of the top frame
				motor\_torque is the motor torque constant
				and electro force is the electro force constant.}
        \label{fig:simulink_bot}
\end{figure}

The adjusted motor constants can be viewed in table \ref{tab:fitted_motor_constants} and the resulting simulated stepresponse interlaced with the physical stepresponse can be seen in figure \ref{fig:validation_steptuning}.

\begin{table}[h]
	\centering
	\begin{tabular}{ll}
		\multicolumn{2}{c}{ \textbf{Top frame} }\\
		\hline
		electromotive force& 0.1\si{ \frac{rad}{Vs}}\\
		motor torque & 1.4 \si{ \frac{N m}{A}}\\
		friction coefficient& 0.57\\

		\multicolumn{2}{c}{ \textbf{Bottom frame} }\\
		\hline
		electromotive force& 3.5\si{ \frac{rad}{Vs}}\\
		motor torque & 1.57 \si{ \frac{N m}{A}}\\
		friction coefficient & 0.5\\
	\end{tabular}
	\caption{Fitted motor constants.}
	\label{tab:fitted_motor_constants}
\end{table}


\begin{figure}[H]
        \centering
				\def\svgwidth{0.47\columnwidth}
				\subfloat[Stepresponse of bottomframe with top frame at 0 degrees.]{%
				\includesvg[\main/afsnit/system_modeling/img/]{sim_validation_top}}
				\def\svgwidth{0.47\columnwidth}
				\subfloat[Stepresponse of top frame, with start at 0 degrees.]{%
				\includesvg[\main/afsnit/system_modeling/img/]{sim_validation_bot}}
				\caption{Stepresponse results of both frames.}
				\label{fig:validation_steptuning}
\end{figure}

It was not possible tune the model to fit the simulated model better to fit the real data, 
which indicates that there are some parameters that are not accounted for in the model.
Since not both velocity and current could be fitted the velocity is prioritised,
because it more important to match velocity/position than current draw of the system.
This increases the requirement for the gain margin of the controller to allow for these disturbances.

\end{document}
