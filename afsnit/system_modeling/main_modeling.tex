\documentclass[../../main]{subfiles}
\begin{document}
\subsection{General model}
\label{sec:General_model}

In this chapter an approximated physical model of the system will be found.\\

By analysis of the forces acting on the motors when voltage is added, the following differential equations are found.\\

\begin{equation}
  \label{equ:model_mech_equ}
  J\cdot \ddot \theta + b\cdot \dot \theta = K_t\cdot i
\end{equation}

\begin{equation}
  \label{equ:model_ele_equ}
  L\cdot \frac{di}{dt} + R\cdot i = V - K_e\cdot \dot \theta
\end{equation}

In (\ref{equ:model_mech_equ}) $J$ is the moment of inertia about the axis of rotation, $b$ is the motor viscous friction constant, $K_t$ is the motor toque constant, $\dot \theta$ is the first time derivative of the position, and $\ddot \theta$ is the second time derivative. The first time derivative is this the velocity and the second is the acceleration.\\
In (\ref{equ:model_ele_equ}) $L$ is the electric inductance of the coil in the motor, $\frac{di}{dt}$ is the first time derivative of the current, $R$ is the ohmic resistance of the motor, $V$ is the voltage applied, $K_e$ is the electromotive force constant and as mentioned above $\dot \theta$ is the velocity.\\
These can now be written in state-space form as shown in eq. (\ref{equ:model_ss_1}) and (\ref{equ:model_ss_2}).

\begin{equation}
      \label{equ:model_ss_1}
      \frac{d}{dt}
    \begin{bmatrix}
        \dot \theta \\
        i
    \end{bmatrix}
    =
    \begin{bmatrix}
        -\frac{b}{J} & \frac{K}{J}\\
        -\frac{K}{L} & -\frac{R}{L}\\
    \end{bmatrix}
    \begin{bmatrix}
        \dot \theta \\
        i \\
    \end{bmatrix}
    +
    \begin{bmatrix}
        0 \\
        \frac{1}{L} \\
    \end{bmatrix}
    V
\end{equation}

\begin{equation}
      \label{equ:model_ss_2}
      y =
    \begin{bmatrix}
        1 & 0
    \end{bmatrix}
    \begin{bmatrix}
        \dot \theta\\
        i\\
    \end{bmatrix}
\end{equation}




\subsection{Application specified model}

To apply the models found in the section \textit{General model} on page \pageref{sec:General_model}, the different constants in this model must be determined. Since the pan-tilt system contains two motors, one for the top-frame, and one for the base-frame, the constants concerning these will from this point on be denoted with the following subscripts in the same order as mentioned above: $K_t$ and $K_{b}$.\\
Firstly the ohmic resistance of the two motors can be seen determined in journal \textit{Determine ohmic resistance of mortors} as $R_t = 4.79 \Omega$ and $R_b = 4.70 \Omega$. The inductance of the motors now also has to be determined. This can be seen done in the journal \textit{Determine electrical inductance of motors}. Here they can be seen as $L_t = L_b = 3.85\cdot 10^{-4}$.\\

To determine the vicious friction experiments not made in this project would be nessecary. Based on the behavior of the system a friction of $b = 0.8$ is used from this point on.\\
The last constant to determine is the moment of inertia.

\subsubsection{Moment of interia - Top frame}
\label{ch:Top_frame_inertia}
To determine the top frame's moment of inertia, $J_{t}$, its seen as an isolated system with only the frames contributing to $J_{t}$, thus the weight of motors and wires on the frame are considered negligible. The system then considered is seen on figure \ref{fig:TopFrame}. Here the axis of rotation can be seen and for this calculation will be our reference.\\

\begin{figure}[h]
  \label{fig:TopFrame}
  \centering
  \includesvg[\main/afsnit/system_modeling/]{TopFrame}
  \caption{Top frame of the pan-tilt system.}
\end{figure}


Since moments of inertia can be added together in components, the frame is to be considered a collection of four bars, as seen on figure (\ref{fig:TopFrame}). From this point on, the notation for a general expression of these components will be $n \in \{a,b,c,d\}$. As it here can be seen, the bars are named such that eq. (\ref{eq:Top_frame_total_inertia_formula}) is true.
\begin{equation}
  \label{eq:Top_frame_total_inertia_formula}
  J_t = \sum J_{t,n} + J_{t,n-1} + \dotsb + J_{t,1} = J_{t,a} + J_{t,b} + J_{t,c} + J_{t,d}
\end{equation}
The contributions of $a$ and $b$ are approximated as linear uniform rods rotating about their center of mass located on the axis of rotation. Since moment of inertia is an expression of the mass distribution about a given axis of rotation, $c$ and $d$ are simply considered particles  rotating about this axis. Its here seen that $c$ has two triangular prism corners, $m_{pri}$, which here will be seen as added mass to $c$. As a final concideration the length of $c$ and $d$ are two times the bar width, which is found to be $L_{bw} = 0.04m$, shorter than $a$ and $b$. With these criteria, the moment of inertia can be determined as seen in eq. (\ref{eq:Top_frame_total_inertia}).

\begin{equation}
  \label{eq:Top_frame_total_inertia}
\begin{split}
  J_t = \sum J_{t,n} =
  \underbrace{\frac{1}{12}m_{t,a}L_{t,a}^2}_\text{$J_t,a$} +
  \underbrace{m_{t,b}\left(\frac{L_{t,a}}{2}\right)^2}_\text{$J_{t,b}$} &+ \\
  \underbrace{(m_{t,c} + 2\cdot m_{pri})\left(\frac{L_{t,a}}{2}\right)^2}_\text{$J_{t,c}$} +
  \underbrace{\frac{1}{12}m_{t,d}L_{t,d}^2}_\text{$J_{t,d}$}
\end{split}
\end{equation}

Thus an expression to calculate the moment of inertia of the top frame is determined.\\

Since the disassembly of the system is not an possibility, the mass of the different components are determined from the mass density $\rho$, and the length of the component. $\rho$ is found in the datasheet \textit{Frame bars} as $\rho = 1.27 \frac{kg}{m}$. The masses relevant for eq. (\ref{eq:Top_frame_total_inertia}) are caculated in table (\ref{tab:mass_table}).

\begin{table}[H]
\centering
\begin{tabular}{|l|l|l|}
\hline
  & $L_{t,n}$ [m]  & $m_{t,n}$ [kg]  \\
\hline
$a$ & 0.291  & 0.3696  \\
\hline
$b$ & 0.291  & 0.2680  \\
\hline
$c$ & 0.2110 & 0.4196  \\
\hline
$d$ & 0.2110 & 0.3696  \\
\hline
$m_{pri}$ & & 0.0758 \\
\hline
\end{tabular}
    \label{tab:mass_table}
\end{table}

Thus the moment of inertia for the top frame can be seen calculated in eq. (\ref{eq:top_frame_inertia_calc})

\begin{equation}
  \centering
    \label{eq:top_frame_inertia_calc}
  \begin{split}
      J_t  \quad  =&  \quad \frac{1}{12} m_{t,a}L_{t,a}^2 + m_{t,b}\left(\frac{L_{t,a}}{2}\right)^2 + (m_{t,c} + 2\cdot m_{pri})\left(\frac{L_{t,a}}{2}\right)^2 \\
      &+ \frac{1}{12}m_{t,d}L_{t,d}^2 \\
      =& \quad  \frac{1}{12} \cdot 0.3696 \si{kg}  \cdot (0.291 \si{m})^2 + 0.2680 \si{kg} \cdot \left(\frac{0.291 \si{m}}{2}\right)^2 \\
      &+ (0.4196 \si{kg} + 2\cdot 0.0758 \si{kg})\left(\frac{0.291\si{kg}}{2}\right)^2 \\
      &+ \frac{1}{12} \cdot 0.3696\si{kg} \cdot (0.2110\si{m})^2 \\
      =& \quad 0.0198 \si{kg\cdot m^2}
  \end{split}
\end{equation}

The top frames moment og inertia is therefore determined to be
\newline $J_{t} = 0.0198 \si{kg\cdot m^2}$

\subsubsection{Moment of interia - Base frame}

To calculate the moment of inertia for the base frame, some observations needs to be made. Firstly the same prosedure as in section \ref{ch:Top_frame} can be followed to determine the base frames own inertia, since the base frame of it selv has a structure identical to the top frame, with one bar being the difference. Secondly, the base frames moment of inertia is directly influenced by the position of the topframe, thus making the base frames moment of inertia a function of the top frames position $\phi$.\\
As in section \ref{cp:Top_frame_inertia} the base frame is fragmented, this time in three parts:$e$, $f$ and $g$ as shown on figure (\ref{fig:ButtomFrame}). The constants related to these components are generally noted by $k$ such that $k \in \{e,f,g\}$. The top frames moment of inertia can now be expressed as seen in eq. (\ref{eq:Base_frame_equ}).

\begin{figure}[h]
  \label{fig:ButtomFrame}
  \centering
  \includesvg[\main/afsnit/system_modeling/]{ButtomFrame}
  \caption{Buttom frame of the pan-tilt system.}
\end{figure}

\begin{equation}
  \label{eq:Base_frame_equ}
  J_b =
  \underbrace{
  \sum J_{b,n} + J_{b,n-1} + \dotsb + J_{b,1}}_\text{$J_{b,const}$} + J_{b,t}(\phi)
\end{equation}

Firstly the constant moment of inertia is determined, which, with the same procedure results in eq. (\ref{eq:top_frame_static}).

\begin{equation}
  J_{b,const} = \frac{1}{12}m_{b,e}L_{b,e}^2 + m_{b,f} \left( \frac{L_{b,e}}{2} \right)^2 + m_{b,g}\left(\frac{L_{b,e}}{2}\right)^2
\end{equation}

The different constants needed to determine $J_{b,cont}$ are listed in table \ref{tab:Base_frame_table}.

\begin{table}[H]
\centering
\begin{tabular}{|l|l|l|}
\hline
  & $L_{b,k}$ [m]  & $m_{b,k}$ [kg]  \\
\hline
$e$ & 0.42  & 0.5334  \\
\hline
$f$ & 0.207  & 0.2629  \\
\hline
$g$ & 0.207 & 0.2629  \\
\hline
\end{tabular}
    \label{tab:mass_table}
\end{table}

$J_{b,const}$ can now de determined as shown in eq. (\ref{eq:J_b,const}).

\begin{equation}
  \label{eq:J_b,const}
  \begin{split}
      J_{b,const} =& \quad \frac{1}{12}m_{b,e}L_{b,e}^2 + m_{b,f} \left( \frac{L_{b,e}}{2} \right)^2 + m_{b,g}\left(\frac{L_{b,e}}{2}\right)^2\\
      =& \quad \frac{1}{12} \cdot 0.5334\si{kg} \cdot (0.42 \si{m})^2 + 0.2629\si{kg} \cdot \left( \frac{0.42 \si{m}}{2} \right)^2 \\
      &+ 0.2629 \si{kg}\cdot \left(\frac{0.42 \si{kg}}{2}\right)^2\\
      =& \quad 0.0304 \si{kg\cdot m^2}
  \end{split}
\end{equation}

Thus the constant moment of inertia of the base frames is determined to be $J_{b,const} = 0.0304 \si{kg\cdot m^2}$
\\
The varying moment of inertia, $J(\phi)$, is dependent on the angular diaplacement of the top frame, from the vertikal axis parallel to the buttom frame. This can from be seen on figure (\ref{fig:TrekantDiagram}).

\begin{figure}[H]
  \label{fig:TrekantDiagram}
  \centering
  \def\svgwidth{0.4\columnwidth}
  \includesvg[\main/afsnit/system_modeling/]{TrekantDiagram}
  \caption{System seen from the side.}
\end{figure}



\subsubsection{Simulation}

\subsection{Stepresponse tuning}
\subsubsection{Correction}
\subsubsection{Comparason}

\subsection{Improvements}

\begin{itemize}
  \item Statefeedback
  \item Kahlman filter
  \item Observer
  \item Controller
\end{itemize}








































\end{document}
